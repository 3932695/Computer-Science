<!DOCTYPE HTML PUBLIC "-//W3O//DTD W3 HTML 2.0//EN">
<!Converted with LaTeX2HTML 95.1 (Fri Jan 20 1995) by Nikos Drakos (nikos@cbl.leeds.ac.uk), CBLU, University of Leeds >
<HEAD>
<TITLE>9.4 Tools</TITLE>
</HEAD>
<BODY>
<meta name="description" value="9.4 Tools">
<meta name="keywords" value="book">
<meta name="resource-type" value="document">
<meta name="distribution" value="global">
<P>
 <BR> <HR><a href="../../../tppmsgs/msgs0.htm#1" tppabs="http://www.mcs.anl.gov/dbpp/"><img ALIGN=MIDDLE src="pictures//asm_color_tiny.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//asm_color_tiny.gif" alt="[DBPP]"></a>    <A NAME=tex2html3288 HREF="node109.html" tppabs="http://www.mcs.anl.gov/dbpp/text/node109.html"><IMG ALIGN=MIDDLE ALT="previous" SRC="pictures//previous_motif.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//previous_motif.gif"></A> <A NAME=tex2html3296 HREF="../../../tppmsgs/msgs0.htm#26" tppabs="http://www.mcs.anl.gov/dbpp/text/node111.html"><IMG ALIGN=MIDDLE ALT="next" SRC="pictures//next_motif.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//next_motif.gif"></A> <A NAME=tex2html3294 HREF="node106.html" tppabs="http://www.mcs.anl.gov/dbpp/text/node106.html"><IMG ALIGN=MIDDLE ALT="up" SRC="pictures//up_motif.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//up_motif.gif"></A> <A NAME=tex2html3298 HREF="node1.html" tppabs="http://www.mcs.anl.gov/dbpp/text/node1.html"><IMG ALIGN=MIDDLE ALT="contents" SRC="pictures//contents_motif.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//contents_motif.gif"></A> <A NAME=tex2html3299 HREF="node133.html" tppabs="http://www.mcs.anl.gov/dbpp/text/node133.html"><IMG ALIGN=MIDDLE ALT="index" SRC="pictures//index_motif.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//index_motif.gif"></A> <a href="../../../tppmsgs/msgs0.htm#2" tppabs="http://www.mcs.anl.gov/dbpp/search.html"><img ALIGN=MIDDLE src="pictures//search_motif.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//search_motif.gif" alt="[Search]"></a>   <BR>
<B> Next:</B> <A NAME=tex2html3297 HREF="../../../tppmsgs/msgs0.htm#26" tppabs="http://www.mcs.anl.gov/dbpp/text/node111.html">9.5 Summary</A>
<B>Up:</B> <A NAME=tex2html3295 HREF="node106.html" tppabs="http://www.mcs.anl.gov/dbpp/text/node106.html">9 Performance Tools</A>
<B> Previous:</B> <A NAME=tex2html3289 HREF="node109.html" tppabs="http://www.mcs.anl.gov/dbpp/text/node109.html">9.3 Data Transformation and Visualization</A>
<BR><HR><P>
<H1><A NAME=SECTION03640000000000000000>9.4 Tools</A></H1>
<P>
<A NAME=secpttools>&#160;</A>
<P>
Next, we describe a number of both public-domain and commercial
performance tools, explaining how each is used to collect and display
performance data.  While the tools exhibit important differences,
there are also many similarities, and frequently our choice of tool
will be driven more by availability than by the features provided.
<P>
<H2><A NAME=SECTION03641000000000000000>9.4.1 Paragraph</A></H2>
<P>
<A NAME=14430>&#160;</A>
Paragraph is a portable trace analysis and visualization package
developed at Oak Ridge National Laboratory for message-passing
programs.  It was originally developed to analyze traces generated by
a message-passing library called the Portable Instrumented
Communication Library (PICL) but can in principle be used to examine
any trace that complies to its format.  Like many message-passing
systems, PICL can be instructed to generate execution traces
automatically, without programmer intervention.
<P>
Paragraph is an interactive tool.  Having specified a trace file, the
user instructs Paragraph to construct various displays concerning processor
utilization, communication, and the like.  The trace files consumed by
Paragraph include, by default, time-stamped events for every
communication operation performed by a parallel program.  Paragraph
performs on-the-fly data reduction to generate the required images.
Users also can record events that log the start and end of
user-defined ``tasks.''
<P>
Paragraph's <em> processor utilization
 </em> displays allow the user
<A NAME=14432>&#160;</A>
to distinguish time spent computing, communicating, and idling.
Communication time represents time spent in system communication
routines, while idle time represents time spent waiting for messages.
These displays can be used to identify load imbalances and code
components that suffer from excessive communication and idle time
costs.  Some of these displays are shown in
<A HREF="#paragraph1">Plate 8</A>,

<P>
which shows a Gantt chart (top part) and a space time diagram (bottom
part) for a parallel climate model executing on 64 Intel DELTA
<A NAME=14437>&#160;</A>
processors.  In the space-time diagram, the color of the lines
representing communications indicates the size of the message being
transferred.  The climate model is a complex program with multiple
phases.  Initially, only processor 0 is active.  Subsequently, the
model alternates between computation and communication phases. Some of
the communication phases involve substantial idle time, which should
be the subject of further investigation.
<P>
<em> Communication
 </em> displays can be used both to obtain more
detailed information on communication volumes and communication
patterns and to study causal relationships, for example between
communication patterns and idle time.
<A HREF="#paragraph2">Plate 10</A>

<P>
shows some of these displays, applied here to the trace data set of
<A HREF="#paragraph1">Plate 8</A>.

<P>
The communication matrix on the left and the circle on the right both
show instantaneous communication patterns.  The colors in the
communication matrix indicate communication volume, as defined by the
scale above the matrix.  Most matrix entries are on the diagonal,
which indicates mostly nearest-neighbor communication.  Another display in
the top right presents cumulative data on processor utilization.
<P>

<P>
<P><HR><P>
<EM>Plate 10 is not available in the online version.</EM>
<P><HR>

<P>
A disadvantage of Paragraph is that the relationship between
performance data and program source is not always clear.  This problem
can be overcome in part by explicitly logging events that record the
start and end of ``tasks'' corresponding to different phases of a
program's execution.  Paragraph provides task Gantt and task histogram
<A NAME=14449>&#160;</A>
displays to examine this information.
<P>
Of the portable tools described here, Paragraph is probably the
simplest to install and use.  Because it operates on automatically
generated traces, it can be used with little programmer intervention.
Paragraph displays are particularly intuitive, although the inability
to scroll within display windows can be frustrating.
<P>
<H2><A NAME=SECTION03642000000000000000>9.4.2 Upshot</A></H2>
<P>
<A NAME=secupshot>&#160;</A>
<P>
<A NAME=14452>&#160;</A>
Upshot is a trace analysis and visualization package developed at
<A NAME=14453>&#160;</A>
Argonne National Laboratory for message-passing programs.  It can be
used to analyze traces from a variety of message-passing systems: in
particular, trace events can be generated automatically by using an
instrumented version of MPI.  Alternatively, the programmer can insert
event logging calls manually.
<P>
Upshot's display tools are designed for the visualization and analysis
<A NAME=14454>&#160;</A>
of state data derived from logged events.  A state is defined by a
starting and ending event.  (For example, an instrumented collective
<A NAME=14455>&#160;</A>
communication routine can generate two separate events on each
processor to indicate when the processor entered and exited the
routine.)  The Upshot Gantt chart display shows the state of each
<A NAME=14456>&#160;</A>
processor as a function of time.  States can be nested, thereby allowing
multiple levels of detail to be captured in a single display.  States
can be defined either in an input file or interactively during
visualization.  A histogramming facility allows the use of histograms
to summarize information about state duration
(<A HREF="#upshot">Plate 11</A>).

<P>
<P><HR>
<A NAME=upshot HREF="../../../tppmsgs/msgs0.htm#27" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures/sam.gif"> <img
ALIGN=MIDDLE src="pictures/sam_small.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures/sam_small.gif"></A>
<P>
(GIF <A HREF="../../../tppmsgs/msgs0.htm#27" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures/sam.gif">24137</A> bytes; RAS <A
HREF="../../../tppmsgs/msgs0.htm#28" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures/sam.rgb">729587</A> bytes.)
Plate 11: Gantt chart, state duration histogram, and
instantaneous state diagram for a search problem running on 16
processors, generated using Upshot.  Image courtesy of E. Lusk.
<P><HR>

<P>
<A HREF="#tilson">Plate 12</A>

<P>
illustrates the use of nested states within Upshot.  This is a trace
<A NAME=14467>&#160;</A>
generated from a computational chemistry code that alternates between
Fock matrix construction (Section <A HREF="node22.html#secchem" tppabs="http://www.mcs.anl.gov/dbpp/text/node22.html#secchem">2.8</A>) and matrix
<A NAME=14469>&#160;</A>
diagonalization, with the former taking most of the time.  Each Fock
matrix construction operation (blue) involves multiple integral
computations (green).  A substantial load imbalance is apparent---some
processors complete their final set of integrals much later than do
others.  The display makes it apparent why this load imbalance occurs.
Integrals are being allocated in a demand-driven fashion by a central
scheduler to ensure equitable distribution of work; however, smaller
integrals are being allocated before larger ones.  Reversing the
allocation order improves performance.
<P>

<P>
<P><HR><P>
<EM>Plate 12 is not available in the online version.</EM>
<P><HR>

<P>
Upshot provides fewer displays than does Paragraph, but has
some nice features.  The ability to scroll and zoom its displays is
particularly useful.
<P>
<H2><A NAME=SECTION03643000000000000000>9.4.3 Pablo</A></H2>
<P>
The Pablo system developed at the University of Illinois is the most
ambitious (and complex) of the performance tools described here.  It
<A NAME=14473>&#160;</A>
provides a variety of mechanisms for collecting, transforming, and
visualizing data and is designed to be extensible, so that the
programmer can incorporate new data formats, data collection
mechanisms, data reduction modules, and displays.  Predefined and
user-defined data reduction modules and displays can be combined in a
mix-and-match fashion by using a graphical editor.  Pablo is as much a
performance tool toolkit as it is a performance tool proper and has
been used to develop performance tools for both message-passing and
data-parallel programs.
<P>
A source code instrumentation interface facilitates the insertion of
user-specified instrumentation into programs.  In addition, Pablo
calls can be incorporated into communication libraries or compilers to
generate trace files automatically.  When logging an event, Pablo can
be requested to invoke a user-defined event handler that may perform
on-the-fly data reduction.  For example, a user-defined handler can
compute communication statistics rather than logging every message or
can combine procedure entry and exit events to determine procedure
execution times.  This very general mechanism provides great
flexibility.  A disadvantage is that the overhead associated with
logging an event is greater than in other, less general systems.
<P>
A novel feature of Pablo is its support for automatic <em>
<A NAME=14474>&#160;</A>
throttling
 </em> of event data generation.  The user can specify a
threshold data rate for each type of event. If events are generated at
a greater rate, event recording is disabled or replaced by periodic
logging of event counts, thereby enabling a variety of
events to be logged without the danger that one will unexpectedly swamp the system.
<P>
Pablo provides a variety of data reduction and display modules that
can be plugged together to form specialized data analysis and
visualization networks.  For example, most displays provided by
Paragraph can be constructed using Pablo modules.  This feature is
illustrated in
<A HREF="#pablo1">Plate 13</A>,

<P>
which shows a variety of Paragraph-like displays and the Pablo network
used to generate them.
<A NAME=14479>&#160;</A>
As noted earlier, Pablo uses its own SDDF.
<P>
<P><HR>
<A NAME=pablo1 HREF="../../../tppmsgs/msgs0.htm#29" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures/PICL.gif"> <img
ALIGN=MIDDLE src="pictures/PICL_small.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures/PICL_small.gif"></A>
<P>
(GIF <A HREF="../../../tppmsgs/msgs0.htm#29" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures/PICL.gif">67844</A> bytes; RGB <A
HREF="../../../tppmsgs/msgs0.htm#30" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures/PICL.rgb">635350</A> bytes.)
Plate 13: Pablo display of performance data collected from a
numerical solver.  Image courtesy of D.~Reed.
<P><HR>

<P>
An interesting feature of the Pablo environment is its support for
novel ``display'' technologies, such as sound and immersive virtual
environments.  Sound appears to be particularly effective for alerting
the
<A NAME=14482>&#160;</A>
user to unusual events, while immersive virtual environments can be
used to display higher-dimensional data, as illustrated in
<A HREF="#pablo2">Plate 14</A>.

<P>
In this plate, each cube represents a different performance metric,
and the spheres within the cubes represent processors moving within a
three-dimensional metric space.  While both approaches are still
experimental at present, they are suggestive of future directions.
<P>
<P><HR>
<A NAME=pablo2 HREF="../../../tppmsgs/msgs0.htm#31" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures/cubescape.gif"> <img
ALIGN=MIDDLE src="pictures/cubescape_small.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures/cubescape_small.gif"></A>
<P>
(GIF <A HREF="../../../tppmsgs/msgs0.htm#31" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures/cubescape.gif">184245</A> bytes; RGB <A
HREF="../../../tppmsgs/msgs0.htm#32" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures/cubescape.rgb">622138</A> bytes.)
Plate 14: Pablo virtual
reality display of performance data.  Image courtesy of D.  Reed.
<P><HR>

<H2><A NAME=SECTION03644000000000000000>9.4.4 Gauge</A></H2>
<P>
<A NAME=14490>&#160;</A>
The Gauge performance tool developed at the California Institute of
Technology is distinguished by its focus on profiles and counters
<A NAME=14491>&#160;</A>
rather than execution traces.  The Gauge display tool allows the user
to examine a multidimensional performance data set in a variety of
ways, collapsing along different dimensions and computing various
higher-order statistics.  For example, a three-dimensional view of an
execution profile uses color to indicate execution time per processor
and per routine; corresponding two-dimensional displays provide
histograms for time per routine summed over all processors or for time
per processor for all routines.  Idle time is also measured on a
per-processor basis and associated with program components by
determining which task is enabled by arrival of a message.  Some of
these displays are illustrated in
<A HREF="#gauge">Plate 7</A>.

<P>
<H2><A NAME=SECTION03645000000000000000>9.4.5 ParAide</A></H2>
<P>
<A NAME=14497>&#160;</A>
The ParAide system developed by Intel's Supercomputer Systems Division
<A NAME=14498>&#160;</A>
is specialized for the Paragon parallel computer.  It incorporates a
variety of different tools.  Modified versions of the standard Unix
<tt> prof</tt> and <tt> gprof</tt> tools provide profiling on a per-node
basis.  An enhanced version of Paragraph provides various data
reduction and display mechanisms.  The System Performance
Visualization system uses displays specialized for the Paragon's
two-dimensional mesh architecture to show data collected by hardware
performance monitors.  These provide detailed low-level information
regarding the utilization of the processor, communication network, and
memory bus.  This fine level of detail is made possible by hardware
and operating system support in the Paragon computer.
<P>
<H2><A NAME=SECTION03646000000000000000>9.4.6 IBM's Parallel Environment</A></H2>
<P>
<A NAME=14502>&#160;</A>
The IBM AIX Parallel Environment is specialized for IBM computers, in
<A NAME=14503>&#160;</A>
particular the SP multicomputer.  It incorporates a variety of
different tools.  A variant of the standard Unix <tt> prof</tt> and <tt>
gprof</tt> commands can be used to generate and process multiple profile
files, one per task involved in a computation.  The Visualization Tool
(VT) can be used to display a variety of different trace data.  Three
types of trace data are supported, as follows:
<OL><LI>
A communication record represents a low-level communication event,
such as a send, receive, or call to a global (collective)
communication routine.
<P>
<LI>
A system statistics record samples low-level statistics such as CPU
utilization, disk traffic, and virtual memory statistics.  The
sampling rate can be selected by the programmer.
<P>
<LI>
An application marker record is generated manually by a programmer and
may be used to delineate distinct stages in a program's execution.
</OL>
Communication trace records and system statistics are generated
automatically, although the programmer can turn them on and off and
can control their frequency.
<P>
VT displays are similar to those provided by Paragraph in many respects, but
they give the programmer greater flexibility in how data are displayed
and can deal with a wider range of data.
<A HREF="#ibmvt">Plate 15</A>

<P>
shows one display, in this case a space-time diagram.
<P>
<H2><A NAME=SECTION03647000000000000000>9.4.7 AIMS</A></H2>
<P>
The Automated Instrumentation and Monitoring System (AIMS) developed
<A NAME=14513>&#160;</A>
at the NASA Ames Research Center provides both instrumentation tools
and a variety of trace visualization mechanisms for message-passing
programs.  Users can either specify trace events manually or request
AIMS to log communication events and procedure calls automatically.
The resulting traces can be visualized by using the AIMS View Kernel (VK),
Pablo, or Paragraph.  A strength of AIMS is its tight
integration with a source code browser that allows the user both to
mark code blocks for tracing and to relate communication events with
source code.  For example, the user can click on a line representing a
communication in a space-time diagram to identify the corresponding
communication operation in the source code.  AIMS also provides
statistical analysis functions that can be used to determine average
resource utilization and message latencies.
<P>
<H2><A NAME=SECTION03648000000000000000>9.4.8 Custom Tools</A></H2>
<P>
We conclude this section by noting that while general-purpose tools
<A NAME=14515>&#160;</A>
have the advantage of being easy to use, custom performance tools can
also be valuable, particularly in
understanding the performance of a complex parallel program.
Extensible tools
such as Pablo can be useful in this regard.  So can text manipulation
systems such as awk and PERL, statistical packages such as Mathematica
and Matlab, and general-purpose graphics packages such as AVS.
<P>
As an example of this approach,
<A HREF="#ccm2">Plate 5</A>

<P>
shows an image generated by a tool developed specifically to help
understand load imbalances in a parallel climate model.  This tool
collects timing data by using interval timers and counters inserted
manually into the parallel climate model.  The data are postprocessed
to compensate for timer overhead and are then displayed by using a
general-purpose graphics package.  Sequences of such images provide
insights into how computational load varies over time, and have
motivated the design of load-balancing algorithms.
<P>

<BR> <HR><a href="../../../tppmsgs/msgs0.htm#1" tppabs="http://www.mcs.anl.gov/dbpp/"><img ALIGN=MIDDLE src="pictures//asm_color_tiny.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//asm_color_tiny.gif" alt="[DBPP]"></a>    <A NAME=tex2html3288 HREF="node109.html" tppabs="http://www.mcs.anl.gov/dbpp/text/node109.html"><IMG ALIGN=MIDDLE ALT="previous" SRC="pictures//previous_motif.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//previous_motif.gif"></A> <A NAME=tex2html3296 HREF="../../../tppmsgs/msgs0.htm#26" tppabs="http://www.mcs.anl.gov/dbpp/text/node111.html"><IMG ALIGN=MIDDLE ALT="next" SRC="pictures//next_motif.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//next_motif.gif"></A> <A NAME=tex2html3294 HREF="node106.html" tppabs="http://www.mcs.anl.gov/dbpp/text/node106.html"><IMG ALIGN=MIDDLE ALT="up" SRC="pictures//up_motif.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//up_motif.gif"></A> <A NAME=tex2html3298 HREF="node1.html" tppabs="http://www.mcs.anl.gov/dbpp/text/node1.html"><IMG ALIGN=MIDDLE ALT="contents" SRC="pictures//contents_motif.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//contents_motif.gif"></A> <A NAME=tex2html3299 HREF="node133.html" tppabs="http://www.mcs.anl.gov/dbpp/text/node133.html"><IMG ALIGN=MIDDLE ALT="index" SRC="pictures//index_motif.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//index_motif.gif"></A> <a href="../../../tppmsgs/msgs0.htm#2" tppabs="http://www.mcs.anl.gov/dbpp/search.html"><img ALIGN=MIDDLE src="pictures//search_motif.gif" tppabs="http://www.mcs.anl.gov/dbpp/text/pictures//search_motif.gif" alt="[Search]"></a>   <BR>
<B> Next:</B> <A NAME=tex2html3297 HREF="../../../tppmsgs/msgs0.htm#26" tppabs="http://www.mcs.anl.gov/dbpp/text/node111.html">9.5 Summary</A>
<B>Up:</B> <A NAME=tex2html3295 HREF="node106.html" tppabs="http://www.mcs.anl.gov/dbpp/text/node106.html">9 Performance Tools</A>
<B> Previous:</B> <A NAME=tex2html3289 HREF="node109.html" tppabs="http://www.mcs.anl.gov/dbpp/text/node109.html">9.3 Data Transformation and Visualization</A>
<BR><HR><P>
<P><ADDRESS>
<I>&#169 Copyright 1995 by <A href="../../../tppmsgs/msgs0.htm#3" tppabs="http://www.mcs.anl.gov/people/foster/">Ian Foster</a></I>
</ADDRESS>
</BODY>
